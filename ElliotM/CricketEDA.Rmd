---
title: "Exploratory Data Analysis for ODI Cricket"
author: "Elliot Moore"
date: "2025-10-05"
output: html_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries, include=FALSE}
# Load libraries
library(tidyverse)
library(tidyr)
```

## Introduction
We are investigating the $\texttt{cricketdata}$ package here, so first we will 
load the required libraries and then we can start our analysis. The package 
$\texttt{cricketdata}$ includes data for Test, ODI and T20 cricket, for Men's and
Women's cricket, however for now we are going to focus on Men's ODI matches. In
particular, we are interested in what factors affect the match outcome in the 
*powerplay*. 

## Powerplay
There are two *powerplays* in each match, the batting powerplay which
is the first 10 overs and the bowling powerplay which is the final 10 overs. During
the batting powerplay, the fielding team is only allowed a maximum of two players
outside the 30-yard circle, encouraging the batting team to take more risk and 
go for boundaries (fours and sixes). The final powerplay favours the bowling team,
and a maximum of 5 fielders are allowed outside the 30-yard circle.


```{r, warning=FALSE,results='hide'}
# Here we load the required libraries
library(fs)
library(readr)
library(ggplot2)
library(knitr)
library(dplyr)
library(cricketdata)
```


```{r, warning=FALSE, results='hide',message=FALSE}
# Here we get our data
data <- read_csv(path_wd("..", "data", "processed", "odi_bbb_recent.csv"))

```

```{r}
glimpse(data)
```

## Toss Decision

Firstly, I wanted to check to see if winning the toss, that is the coin toss to
determine which team chooses to bat first or bowl first, has any impact on the 
match outcome.

Most cricket matches on the TV start with the pundits talking about how batting
or bowling first is a big advantage based on the weather and pitch condition.

I looked online for papers relating to this and did find that a small advantage 
was found in [@sood2016fairlyrandomimpactwinning] - the team that wins the toss
was found to win more often. I would like to explore whether choosing to bat 
first or bowl first has an impact on the match outcome.

Since we have ball by ball data, it's a good idea to summarise the data first, 
only keeping the key information.


```{r, Heatmap 1}
heatmap_data <- data %>%
  distinct(match_id, toss_winner, toss_decision, winner) %>%
  mutate(toss_winner_won = ifelse(toss_winner == winner, "Yes", "No")) %>%
  count(toss_decision, toss_winner_won) %>%
  group_by(toss_decision) %>%
  mutate(perc = n / sum(n) * 100)

ggplot(heatmap_data, aes(x = toss_decision, y = toss_winner_won, fill = perc)) +
  geom_tile(color = "white") +
  geom_text(aes(label = sprintf("%.1f%%", perc)), color = "black", size = 5) +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(
    title = "Toss Decision vs. Match Outcome (as % of Toss Decisions)",
    x = "Decision After Winning Toss",
    y = "Did Toss Winner Also Win?",
    fill = "Percentage"
  ) +
  theme_minimal()

```

Here, NA is no match outcome - some matches are rained off or cancelled for other
reasons. Therefore I decided to remove this from the heatmap as it is not
useful for our analysis.

```{r, Toss Winning Heatmap}
heatmap_data <- data %>%
  distinct(match_id, toss_winner, toss_decision, winner) %>%
  # Remove matches with no result
  filter(!is.na(winner)) %>%
  mutate(toss_winner_won = ifelse(toss_winner == winner, "Yes", "No")) %>%
  count(toss_decision, toss_winner_won) %>%
  group_by(toss_decision) %>%
  mutate(perc = n / sum(n) * 100)

ggplot(heatmap_data, aes(x = toss_decision, y = toss_winner_won, fill = perc)) +
  geom_tile(color = "white") +
  geom_text(aes(label = sprintf("%.1f%%", perc)), color = "white", size = 5) +
  scale_fill_gradient(low = "red", high = "green") +
  labs(
    title = "Toss Decision vs. Match Outcome",
    x = "Decision After Winning Toss",
    y = "Did Toss Winner Also Win?",
    fill = "Percentage"
  ) +
  theme_minimal()

```

Here we can see a 3.4% difference favouring the decision to field first.


The heatmap shows us that deciding to field first is the better decision
when all other factors are ignored - weather and pitch quality are usually the 
main factors considered by teams.

## Powerplay Analysis

Let's take a look at the powerplay - in particular how many boundaries are scored
during the batting powerplay and how many wickets are lost. The big idea here 
being that if we were building a model for predicting match outcome as the game 
is being played, the powerplay would be a key indicator of how well a team's innings
is going.

```{r, Powerplay boundaries}
powerplay_boundaries <- data %>%
  filter(ball < 10, runs_off_bat %in% c(4, 6)) %>%  # only Powerplay & boundaries
  group_by(match_id, batting_team) %>%
  summarise(boundaries = n(), .groups = "drop")

powerplay_outcome <- data %>%
  distinct(match_id, batting_team, winner) %>%
  mutate(result = ifelse(batting_team == winner, "Won", "Lost"))

powerplay_summary <- powerplay_boundaries %>%
  left_join(powerplay_outcome, by = c("match_id", "batting_team")) %>%
  filter(!is.na(result))

```


```{r}
powerplay_summary %>%
  ggplot(aes(x = boundaries, fill = result)) +
  geom_histogram(position = "identity", alpha = 0.6, bins = 15) +
  scale_fill_manual(values = c("Won" = "green", "Lost" = "red")) +
  labs(title = "Boundaries in Powerplay vs Match Outcome",
       x = "Number of Boundaries in First 10 Overs",
       y = "Number of Innings",
       fill = "Match Result") +
  theme_minimal()

```

This distribution shows very clearly that teams that score more boundaries in the
*batting powerplay* tend to win more matches - the green distribution shows teams that
win matches. Therefore boundaries during the powerplay is likely to be a useful
indicator of which team will win.

Let's also look at wickets during the *bowling powerplay* - if a team loses more 
wickets early on in the game, we'd expect them to lose the match on average.

```{r}
powerplay_stats <- data %>%
  filter(ball < 10) %>%
  group_by(match_id, batting_team) %>%
  summarise(
    boundaries = sum(runs_off_bat %in% c(4, 6)),       # count boundaries
    wickets = sum(!is.na(wicket_type)),                # count wickets lost
    .groups = "drop"
  )

match_outcomes <- data %>%
  distinct(match_id, batting_team, winner) %>%
  mutate(result = ifelse(batting_team == winner, "Won", "Lost"))

powerplay_summary <- powerplay_stats %>%
  left_join(match_outcomes, by = c("match_id", "batting_team")) %>%
  filter(!is.na(result))

```





```{r}
powerplay_summary %>%
  group_by(wickets) %>%
  summarise(win_rate = mean(result == "Won"), n = n(), .groups = "drop") %>%
  ggplot(aes(x = wickets, y = win_rate)) +
  geom_point(size = 3, color = "blue") +
  geom_line(group = 1, color = "blue") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Win Probability vs Wickets Lost in Powerplay",
       x = "Wickets Lost (First 10 Overs)",
       y = "Win Probability") +
  theme_minimal()

```
This plot shows the rapid and clear decline of win probability as the batting team
loses wickets in the *bowling powerplay*. If a team loses 5 wickets, their chance
of winning drops to just 10%, and any more leads to a certain loss.

## Discussion

In this EDA, I have worked with two sets of structured data - match data with 
features such as venue, teams and winner and ball-by-ball data where each row 
represents one delivery, with information on batter, bowler, runs scored etc.

The main data resource used was the $\texttt{cricketdata}$ package, and the 
software used for plotting and data manipulation was mainly $\texttt{dyplr}$, 
$\texttt{ggplot2}$ and $\texttt{tidyverse}$.

The types of problems the resources solve can be predictive problems, e.g. using 
the ball-by-ball data to predicting match outcome based on performance in the 
powerplay.  

The approach used in this EDA is very generlisable to other datasets - one could
analyse financial data or any other sports data in a similar way.

I personally found that using GitHub was a positive experience for collaboration,
we worked together on this project in person and remotely, therefore being able 
to push your update and fetch other people's updates was easy and useful. The 
main concern I had with GitHub was that when two people were working on a file at 
the same time - e.g. the report - we faced issues.






## References

For this EDA I used the package $\texttt{ggplot2}$ extensively so I have referenced the
documentation below

ggplot documentation: https://ggplot2.tidyverse.org/reference/index.html
