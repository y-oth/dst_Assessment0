---
title: "RAnalysis"
output: html_document
date: "2025-10-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Daniel's Analysis

## Introduction

The following document contains analysis of the cricket data (From cricsheet, see 01-Data) and written myself in R.

The following library's are required for this document

```{r}
library(fs)
library(readr)
library(ggplot2)
library(knitr)
library(dplyr)
```

In the chunks below I used dplyr to allow me to analyse the data more effectively. I used a [cheat sheet](https://posit.co/wp-content/uploads/2022/10/data-transformation.pdf) [3] and the [R for Data Science guide](https://r4ds.had.co.nz/transform.html) [4] to learn how to use the package.

## Reading in the data

```{r}
data <- read_csv(path_wd("..", "data", "processed", "odi_bbb_recent.csv"))
```

```{r}
glimpse(data)
```

## Initial EDA

First I want to get a brief summary of some of some of the variables.

```{r}
print(sort(unique(data$runs_off_bat)))
summary(data$runs_off_bat)



```

We can see that batters are fairly conservative with at least half of the balls resulting in no runs and less than 25% being more than singles. Lets see how this compares from one innings to another.

```{r}

ggplot(odi_bbb_recent, aes(x = factor(innings), y = runs_off_bat)) +
  geom_boxplot(fill = "skyblue") +
  labs(x = "Innings", y = "Runs off the bat",
       title = "Distribution of runs per ball by innings")



```

This is strange - typically ODIs have strictly 2 innings. The 3rd and 4th innings only occur when the match is tied and we go to a 'Super Over' which is why the distribution of Runs off Bat is skewed so much higher for these cases.

```{r}
bad_match_ids <- data %>%
  filter(innings > 2) %>%
  distinct(match_id) %>%
  pull()

print(bad_match_ids)

print(length(bad_match_ids) / length(unique(data$match_id)))
```

There are only 5 matches this has occurred - which is around 0.4% of all matches in our data set. As a result we will ignore it for now. Lets have a look at Innings 1 and 2 in more detail.

```{r}
library(dplyr)

runs_dist <- data %>%
  filter(innings %in% c(1, 2)) %>%
  group_by(innings, runs_off_bat) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(innings) %>%
  mutate(prop = count / sum(count))

ggplot(runs_dist, aes(x = factor(runs_off_bat), y = prop, fill = factor(innings))) +
  geom_col(position = "dodge") +
  labs(
    title = "Run Distribution by Innings",
    x = "Runs Off Bat",
    y = "Proportion of Balls",
    fill = "Innings"
  ) +
  theme_minimal()

```

There doesn't seem to be a significant difference.

## Home advantage

During the literature review I found a paper by Kaluarachchi and Aparna [1] trying to investigate the effects of home advantage on the outcome of the game. I attempt to investigate that relation using this dataset.

### Home vs Away

```{r}
length(unique(data$venue))
```

```{r}
library(dplyr)

venue_country <- tribble(
  ~venue, ~country,
  "Hagley Oval", "New Zealand",
  "Dubai International Cricket Stadium", "UAE",
  "Seddon Park", "New Zealand",
  "Sydney Cricket Ground", "Australia",
  "Kingsmead", "South Africa",
  "Eden Park", "New Zealand",
  "New Wanderers Stadium", "South Africa",
  "Melbourne Cricket Ground", "Australia",
  "Saxton Oval", "New Zealand",
  "Brisbane Cricket Ground, Woolloongabba", "Australia",
  "Buffalo Park", "South Africa",
  "Bellerive Oval", "Australia",
  "University Oval", "New Zealand",
  "St George's Park", "South Africa",
  "SuperSport Park", "South Africa",
  "Westpac Stadium", "New Zealand",
  "Western Australia Cricket Association Ground", "Australia",
  "McLean Park", "New Zealand",
  "Adelaide Oval", "Australia",
  "Manuka Oval", "Australia",
  "Shere Bangla National Stadium", "Bangladesh",
  "The Village, Malahide", "Ireland",
  "Gaddafi Stadium", "Pakistan",
  "Edgbaston", "England",
  "Kennington Oval", "England",
  "The Rose Bowl", "England",
  "Trent Bridge", "England",
  "Riverside Ground", "England",
  "Zahur Ahmed Chowdhury Stadium", "Bangladesh",
  "Harare Sports Club", "Zimbabwe",
  "Rangiri Dambulla International Stadium", "Sri Lanka",
  "Pallekele International Cricket Stadium", "Sri Lanka",
  "R Premadasa Stadium", "Sri Lanka",
  "Mahinda Rajapaksa International Cricket Stadium, Sooriyawewa", "Sri Lanka",
  "Senwes Park", "South Africa",
  "Civil Service Cricket Club, Stormont", "Northern Ireland",  # Stormont, Belfast
  "Lord's", "England",
  "Old Trafford", "England",
  "Headingley", "England",
  "Green Park", "India",
  "Holkar Cricket Stadium", "India",
  "Saurashtra Cricket Association Stadium", "India",
  "MA Chidambaram Stadium, Chepauk", "India",
  "Wankhede Stadium", "India",
  "Sheikh Zayed Stadium", "UAE",
  "Sharjah Cricket Stadium", "UAE",
  "ICC Academy", "UAE",
  "Bay Oval", "New Zealand",
  "Basin Reserve", "New Zealand",
  "Mangaung Oval", "South Africa",
  "Newlands", "South Africa",
  "Providence Stadium", "West Indies",
  "Warner Park, Basseterre", "West Indies",
  "Kensington Oval, Bridgetown", "West Indies",
  "County Ground", "England",
  "Sophia Gardens", "Walesm",
  "Grange Cricket Club Ground, Raeburn Place", "Scotland",
  "Willowmoore Park", "South Africa",
  "Himachal Pradesh Cricket Association Stadium", "India",
  "Punjab Cricket Association Stadium, Mohali", "India",
  "JSCA International Stadium Complex", "India",
  "Dr. Y.S. Rajasekhara Reddy ACA-VDCA Cricket Stadium", "India",
  "Mission Road Ground, Mong Kok", "Hong Kong",
  "Queens Sports Club", "Zimbabwe",
  "Maharashtra Cricket Association Stadium", "India",
  "Barabati Stadium", "India",
  "Eden Gardens", "India",
  "ICC Global Cricket Academy", "UAE",
  "Sir Vivian Richards Stadium, North Sound", "West Indies",
  "Sinhalese Sports Club Ground", "Sri Lanka",
  "Malahide", "Ireland",
  "Clontarf Cricket Club Ground", "Ireland",
  "Queen's Park Oval, Port of Spain", "West Indies",
  "Galle International Stadium", "Sri Lanka",
  "Sabina Park, Kingston", "West Indies",
  "The Cooper Associates County Ground", "England",
  "Bready Cricket Club, Magheramason", "Northern Ireland",
  "R.Premadasa Stadium, Khettarama", "Sri Lanka",
  "Providence Stadium, Guyana", "West Indies",
  "Queen's Park Oval, Trinidad", "West Indies",
  "Mannofield Park", "Scotland",
  "Sportpark Het Schootsveld", "Netherlands",
  "Central Broward Regional Park Stadium Turf Ground", "USA",
  "National Stadium", "Pakistan",
  "Grange Cricket Club, Raeburn Place", "Scotland",
  "Castle Avenue", "Ireland",
  "Affies Park", "South Africa",
  "Wanderers Cricket Ground", "Namibia",  # or South Africa depending on context
  "Arun Jaitley Stadium", "India",
  "Al Amerat Cricket Ground Oman Cricket (Ministry Turf 1)", "Oman",
  "Vidarbha Cricket Association Stadium, Jamtha", "India",
  "The Wanderers Stadium", "South Africa",
  "Darren Sammy National Cricket Stadium, St Lucia", "West Indies",
  "Kensington Oval, Barbados", "West Indies",
  "National Cricket Stadium, Grenada", "West Indies",
  "M.Chinnaswamy Stadium", "India",
  "Tribhuvan University International Cricket Ground", "Nepal",
  "Boland Park", "South Africa",
  "Sylhet International Cricket Stadium", "Bangladesh",
  "Rajiv Gandhi International Stadium, Uppal", "India",
  "Shere Bangla National Stadium, Mirpur", "Bangladesh",
  "Perth Stadium", "Australia",
  "Greenfield International Stadium", "India",
  "Diamond Oval", "South Africa",
  "Old Hararians", "Zimbabwe",
  "Bulawayo Athletic Club", "Zimbabwe",
  "Punjab Cricket Association IS Bindra Stadium, Mohali", "India",
  "Cobham Oval (New)", "New Zealand",
  "Kinrara Academy Oval", "Malaysia",
  "Barsapara Cricket Stadium", "India",
  "Rawalpindi Cricket Stadium", "Pakistan",
  "Sir Vivian Richards Stadium", "West Indies",
  "SuperSport Park, Centurion", "South Africa",
  "Hazelaarweg, Rotterdam", "Netherlands",
  "Kennington Oval, London", "England",
  "Lord's, London", "England",
  "The Village, Malahide, Dublin", "Ireland",
  "Edgbaston, Birmingham", "England",
  "Kensington Oval, Bridgetown, Barbados", "West Indies",
  "R Premadasa Stadium, Colombo", "Sri Lanka",
  "Al Amerat Cricket Ground Oman Cricket (Ministry Turf 2)", "Oman",
  "Sabina Park, Kingston, Jamaica", "Jamaica",
  "Boland Park, Paarl", "South Africa",
  "Narendra Modi Stadium, Ahmedabad", "India",
  "Shere Bangla National Stadium, Dhaka", "Bangladesh",
  "Eden Park, Auckland", "New Zealand",
  "Hagley Oval, Christchurch", "New Zealand",
  "United Cricket Club Ground, Windhoek", "Namibia",
  "Zahur Ahmed Chowdhury Stadium, Chattogram", "Bangladesh",
  "Barsapara Cricket Stadium, Guwahati", "India",
  "Greenfield International Stadium, Thiruvananthapuram", "India",
  "Eden Gardens, Kolkata", "India",
  "Rajiv Gandhi International Stadium, Uppal, Hyderabad", "India",
  "Shaheed Veer Narayan Singh International Stadium, Raipur", "India",
  "Holkar Cricket Stadium, Indore", "India",
  "Mangaung Oval, Bloemfontein", "South Africa",
  "Diamond Oval, Kimberley", "South Africa",
  "Buffalo Park, East London", "South Africa",
  "Wankhede Stadium, Mumbai", "India",
  "Dr. Y.S. Rajasekhara Reddy ACA-VDCA Cricket Stadium, Visakhapatnam", "India",
  "Senwes Park, Potchefstroom", "South Africa",
  "MA Chidambaram Stadium, Chepauk, Chennai", "India",
  "Willowmoore Park, Benoni", "South Africa",
  "National Stadium, Karachi", "Pakistan",
  "County Ground, Chelmsford", "England",
  "Queens Sports Club, Bulawayo", "Zimbabwe",
  "Takashinga Sports Club, Highfield, Harare", "Zimbabwe",
  "Brian Lara Stadium, Tarouba, Trinidad", "West Indies",
  "The Rose Bowl, Southampton", "England",
  "Sedgars Park, Potchefstroom", "South Africa",
  "Punjab Cricket Association IS Bindra Stadium, Mohali, Chandigarh", "India",
  "Trent Bridge, Nottingham", "England",
  "Saurashtra Cricket Association Stadium, Rajkot", "India",
  "Himachal Pradesh Cricket Association Stadium, Dharamsala", "India",
  "Maharashtra Cricket Association Stadium, Pune", "India",
  "M Chinnaswamy Stadium, Bengaluru", "India",
  "Choice Moosa Stadium, Pearland", "USA",
  "Multan Cricket Stadium", "Pakistan",
  "Mulpani Cricket Ground", "Nepal",
  "Feroz Shah Kotla", "India",   # now renamed Arun Jaitley Stadium, but still in Delhi
  "Sir Vivian Richards Stadium, North Sound, Antigua", "West Indies",
  "University Oval, Dunedin", "New Zealand",
  "St George's Park, Gqeberha", "South Africa",
  "Saxton Oval, Nelson", "New Zealand",
  "McLean Park, Napier", "New Zealand",
  "Manuka Oval, Canberra", "Australia",
  "Forthill, Dundee", "Scotland",
  "Sportpark Westvliet, The Hague", "Netherlands",
  "Sher-e-Bangla National Cricket Stadium", "Bangladesh",
  "Maple Leaf North-West Ground, King City", "Canada",
  "Zayed Cricket Stadium, Abu Dhabi", "UAE",
  "Grand Prairie Stadium, Dallas", "USA",
  "Warner Park, Basseterre, St Kitts", "West Indies",
  "Basin Reserve, Wellington", "New Zealand",
  "Brabourne Stadium", "India",
  "Vidarbha Cricket Association Stadium, Jamtha, Nagpur", "India",
  "Barabati Stadium, Cuttack", "India",
  "Central Broward Regional Park Stadium Turf Ground, Lauderhill", "USA",
  "Castle Avenue, Dublin", "Ireland",
  "Great Barrier Reef Arena, Mackay", "Australia"
)

data <- data %>%
  select(-starts_with("country")) %>%    # remove all country columns
  left_join(venue_country, by = "venue") # join fresh

# Check if any venues did not get matched
unmatched <- data %>%
  filter(is.na(country)) %>%
  distinct(venue)

print(unmatched)

```

I attempted to investigate Home vs Away Advantage by using ChatGPT to write a script to convert venue into country however it continued to miss venues and was unreliable so I scrapped that idea.

```{r}
data <- data %>%
  select(-starts_with("country"))
glimpse(data)
```

## Event Sequence/ Time Series Structure

The ball-by-ball (bbb) cricket data is inherently an event sequence structure which we can index by balls or overs. In this section I aim to demonstrate that structure and investigate any interesting features.

```{r}
data %>%
  mutate(over = ceiling(ball)) %>%
  group_by(match_id, innings, over) %>%
  summarise(over_runs = sum(runs_off_bat + extras, na.rm = TRUE), .groups = "drop") %>%
  group_by(innings, over) %>%
  summarise(avg_runs = mean(over_runs, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = over, y = avg_runs, color = factor(innings))) +
  geom_line(size = 1) +
  geom_vline(xintercept = 10, linetype = "dotted", color = "red", size = 1) +
  geom_vline(xintercept = 40, linetype = "dotted", color = "red", size = 1) +
  labs(
    title = "Average Runs per Over by Innings",
    x = "Over", 
    y = "Average Runs", 
    color = "Innings"
  ) +
  theme_minimal()



```

Here we can clearly see the event series structure. There are 3 sections in an ODI cricket game, referring to the restrictions placed on the fielding team. In the first 'Powerplay' the batting team have an advantage, making it easier for them to get boundaries (4s and 6s). We can see this by the slightly increased average runs per over for the first 10 overs (once they get their eye in). We can also see that the average runs per over generally increases with time. At 40 overs the second 'Powerplay' occurs which gives the bowling team the advantage. This period is sometimes referred to as the death and despite the fact that the bowling team has an advantage, the run rate steeply increases, particularly in the first innings. This is because they are taking more risks to attempt to set a high a target for the other team as possible. It also increases in the second innings but less so as they can afford to be more conservative as they know what goal they need to reach.

### Risk taking throughout the match

One way we can attempt to quantify risk taking/ shifts in strategy is by looking at the distribution of boundaries throughout the game. This demonstrates the underlying structure of the previous plot, a higher proportion of boundaries in the first and last 10 overs.

```{r}

data %>%
  mutate(over = ceiling(ball)) %>%
  group_by(over) %>%
  summarise(
    total_balls = n(),
    boundaries = sum(runs_off_bat %in% c(4, 6), na.rm = TRUE)
  ) %>%
  mutate(boundary_rate = boundaries / total_balls) %>%
  ggplot(aes(x = over, y = boundary_rate)) +
  geom_vline(xintercept = 10, linetype = "dashed", color = "red", size = 1) +
  geom_vline(xintercept = 40, linetype = "dashed", color = "red", size = 1) +
  geom_col(fill = "steelblue") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Proportion of Balls that are Boundaries by Over",
       x = "Over",
       y = "Boundary Proportion") +
  theme_minimal()



```
Another way to see that this is 'risky' is by looking at the distribution of dismissals. Here we can see that the you are slightly more likely to be dismissed in the first 10 overs, due to the risk taking, however this is offset by having your best batters bat first. In the last 10 overs it increases massively as we have worse batters taking more risks.

```{r}
wickets_data <- data %>%
  filter(!is.na(player_dismissed)) %>%
  mutate(over = ceiling(ball))

ggplot(wickets_data, aes(x = over)) +
  geom_histogram(aes(y = after_stat(density)),
                 binwidth = 1,
                 fill = "red", color = "black", alpha = 0.6) +
  labs(title = "Density of Wickets by Over",
       x = "Over", y = "Density of Wickets") +
  geom_vline(xintercept = c(10, 40), linetype = "dotted", color = "blue") +
  theme_minimal()
```

Lets combine what we have learnt so far and see if we can see it to an individual game.


One way to visualise the event series popularised by ESPNcricinfo [2] is the 'worm chart'.

```{r}
data <- data %>%
  mutate(over = ceiling(ball))

data <- data %>%
  mutate(total_runs = runs_off_bat + ifelse(is.na(extras), 0, extras))

worm_data <- data %>%
  group_by(match_id, innings, over) %>%
  summarise(runs = sum(total_runs, na.rm = TRUE), .groups = "drop") %>%
  group_by(match_id, innings) %>%
  mutate(cum_runs = cumsum(runs))



ggplot(filter(worm_data, match_id == 749781),
       aes(x = over, y = cum_runs, colour = factor(innings))) +
  geom_line(size = 1) +
  labs(title = "Worm Chart - New Zealand vs Sri Lanka",
       x = "Over", y = "Cumulative Runs",
       colour = "Innings")


```

Lets see if we can uncover any other structure within the data by looking at another event - a player getting a wicket - and seeing if that has any effect on the run rate.

```{r}
wickets_data <- data %>%
  filter(!is.na(player_dismissed)) %>%   # keep only rows where a wicket fell
  group_by(match_id, innings, over) %>%
  summarise(wickets = n(), .groups = "drop") %>%   # how many wickets in that over
  left_join(worm_data, by = c("match_id", "innings", "over"))

ggplot(filter(worm_data, match_id == 749781),
       aes(x = over, y = cum_runs, colour = factor(innings))) +
  geom_line(size = 1) +
  # Add wickets
  geom_point(data = filter(wickets_data, match_id == 749781),
             aes(x = over, y = cum_runs),
             colour = "black", shape = 1, size = 3, stroke = 1.2) +
  labs(title = "Worm Chart - New Zealand vs Sri Lanka",
       x = "Over", y = "Cumulative Runs",
       colour = "Innings") +
  theme_minimal()

```


```{r}


```


## References

[1] A. Kaluarachchi and S. V. Aparna, "CricAI: A classification based tool to predict the outcome in ODI cricket," 2010 Fifth International Conference on Information and Automation for Sustainability, Colombo, Sri Lanka, 2010, pp. 250-25

[2] [ESPNcricinfo](https://www.espncricinfo.com/series/west-indies-in-england-2025-1448331/england-vs-west-indies-1st-odi-1448343/match-statistics)

[3] [dplyr cheat sheet](https://posit.co/wp-content/uploads/2022/10/data-transformation.pdf)

[4] [R for Data Science (Wickham & Grolemund)](https://r4ds.had.co.nz/transform.html)
